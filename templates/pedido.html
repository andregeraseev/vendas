{% extends 'base.html' %}
{% load static %}
{% block content %}
<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<div id="alert_placeholder"></div>
{% if messages %}
{% for message in messages %}
<div class="alert alert-{{message.tags}}" role="alert">

    {{ message }}

</div>
{% endfor %}
{% endif %}

<div class="container mt-3">
    <div class="row">
        <div class="col-8">

            <table class="table table-striped table-inverse table-responsive">

                <thead class="thead-default">
                <tr>
                    <th>Produto</th>
                    <th>Valor</th>
                    <th>Quantidade</th>
                    <th></th>
                </tr>
                </thead>

                <thead class="thead-dark">
                <th>JUICES 0 MG</th>

                </thead>
                <tbody class="table-group-divider">
                {% for produto in produtos0mg %}
                <tr>
                    <td scope="row">{{produto.nome}} {{produto.mg}}</td>
                    <td>{{produto.valor}}</td>
                    <form method="post" id="add_item{{produto.id}}">
                        {% csrf_token %}
                        <div class="form-group">
                            <input type="hidden" class="form-control" name="pedido{{produto.id}}" id="pedido{{produto.id}}" value="1">
                            <input type="hidden" class="form-control" name="produto{{produto.id}}" id="produto{{produto.id}}"
                                   value="{{ produto.pk }}">
                            <td>
                                <div class="col-3">

                                    <input type="number"
                                           class="form-control quantidade{{produto.id}}" name="quantidade{{produto.id}}" id="quantidade{{produto.id}}" value="0" placeholder="">
                                </div>
                            </td>
                            <td>
                                <button type="submit" class="btn btn-danger">Adicionar</button>


            </div>

                        </div>
                            </td>
                        </div>
                    </form>
                </tr>

                <script>
     $(document).ready(function(event) {

            // catch the form's submit event
            $('#add_item{{produto.id}}').submit(function (e) {
            e.preventDefault();
        var quantidade = document.getElementById("quantidade{{produto.id}}").value;
        var id_produto = document.getElementById("produto{{produto.id}}").value;


        $.ajax({
            type: "POST",
            url: "adicionar_item",
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'quantidade' : quantidade,
                'id_produto' : id_produto,

            },
            success: function (data) {
            if (data.success != undefined) {
            alert(data.success);
            console.log(data.success);}

            $('#pedido_carrinho').html(data);



            if (data.erro != undefined) {
            console.log(data.erro);}


            if (data.success != undefined) {
            showalert((data.success), "alert-success");}

            else if (data.erro == "quantidade inferior a 1") {
            showalert((data.erro), "alert-warning");}

            else   {
            showalert((data.erro), "alert-danger");}




      },

            error: function (data) {
                        // alert the error if any error occured
                        showalert((data.erro), "alert-danger");
                        alert(data.erro);
                        console.log(data.erro)
                    },

        }).done(function(e){
            console.log("done")

        })
        .fail(function(e){
            console.log('error')
            console.log(e)
        })

    });
    function showalert(message, alerttype) {
    $('#alert_placeholder').append('<div id="alertdiv" class="alert ' +  alerttype + '" role="alert">' + message + '</div>');
    setTimeout(function() {
        $("#alertdiv").remove();
    }, 5000);
 }

    })

</script>

                {% endfor %}
                <thead class="thead-dark">
                <th>JUICES 3 MG</th>

                </thead>
                <tbody class="table-group-divider">
                {% for produto in produtos3mg %}
                <tr>
                    <td scope="row">{{produto.nome}} {{produto.mg}}</td>
                    <td>{{produto.valor}}</td>
                    <form method="post" action="adicionar_item">
                        {% csrf_token %}
                        <div class="form-group">
                            <input type="hidden" class="form-control" name="pedido" id="pedido" value="1">
                            <input type="hidden" class="form-control" name="id_produto" id="produto"
                                   value="{{ produto.pk }}">
                            <td>
                                <div class="col-3">

                                    <input type="number"
                                           class="form-control" name="quantidade" id="un" value="0" placeholder="">
                                </div>
                            </td>
                            <td>
                                <button type="submit" class="btn btn-danger">Adicionar</button>
                            </td>
                        </div>
                    </form>
                </tr>

                {% endfor %}
                <thead class="thead-dark">
                <th>JUICES 6 MG</th>

                </thead>
                <tbody class="table-group-divider">
                {% for produto in produtos6mg %}
                <tr>
                    <td scope="row">{{produto.nome}} {{produto.mg}}</td>
                    <td>{{produto.valor}}</td>
                    <form method="post" action="adicionar_item">
                        {% csrf_token %}
                        <div class="form-group">
                            <input type="hidden" class="form-control" name="pedido" id="pedido" value="1">
                            <input type="hidden" class="form-control" name="id_produto" id="produto"
                                   value="{{ produto.pk }}">
                            <td>
                                <div class="col-3">

                                    <input type="number"
                                           class="form-control" name="quantidade" id="un" value="0" placeholder="">
                                </div>
                            </td>
                            <td>
                                <button type="submit" class="btn btn-danger">Adicionar</button>
                            </td>
                        </div>
                    </form>
                </tr>

                {% endfor %}
                <thead class="thead-dark">
                <th>JUICES 9 MG</th>

                </thead>
                <tbody class="table-group-divider">
                {% for produto in produtos9mg %}

                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="triggerId">
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item disabled" href="#">Disabled action</a>
                        <h6 class="dropdown-header">Section header</h6>
                        <a class="dropdown-item" href="#">Action</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">After divider action</a>
                    </div>
                </div>
                <tr>
                    <td scope="row">{{produto.nome}} {{produto.mg}}</td>
                    <td>{{produto.valor}}</td>
                    <form method="post" action="adicionar_item">
                        {% csrf_token %}
                        <div class="form-group">
                            <input type="hidden" class="form-control" name="pedido" id="pedido" value="1">
                            <input type="hidden" class="form-control" name="id_produto" id="produto"
                                   value="{{ produto.pk }}">
                            <td>
                                <div class="col-3">

                                    <input type="number"
                                           class="form-control" name="quantidade" id="un" value="0" placeholder="">
                                </div>
                            </td>
                            <td>
                                <button type="submit" class="btn btn-danger">Adicionar</button>
                            </td>
                        </div>
                    </form>
                </tr>

                {% endfor %}
                <thead class="thead-dark">
                <th>JUICES 12 MG</th>

                </thead>
                <tbody class="table-group-divider">
                {% for produto in produtos12mg %}
                <tr>
                    <td scope="row">{{produto.nome}} {{produto.mg}}</td>
                    <td>{{produto.valor}}</td>
                    <form method="post" action="adicionar_item" >
                        {% csrf_token %}
                        <div class="form-group">
                            <input type="hidden" class="form-control" name="pedido" id="pedido" value="1">
                            <input type="hidden" class="form-control" name="id_produto" id="produto"
                                   value="{{ produto.pk }}">
                            <td>
                                <div class="col-3">

                                    <input type="number"
                                           class="form-control" name="quantidade" id="un" value="0" placeholder="">
                                </div>
                            </td>
                            <td>
                                <button type="submit" class="btn btn-danger">Adicionar</button>
                            </td>
                        </div>
                    </form>
                </tr>

                {% endfor %}

                <div id='pedido_carrinho'>
                    {% include 'partials/_items.html' %}
                </div>

{% endblock %}


